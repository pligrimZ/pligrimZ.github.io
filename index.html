<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>トゲナシトゲアリ　最推し楽曲</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    color: #333;
}
.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}
h1 {
    color: #2c3e50;
    margin-bottom: 10px;
    font-size: 28px;
}
.subtitle {
    color: #7f8c8d;
    margin-bottom: 30px;
    font-size: 16px;
}
#progress {
    margin: 30px auto;
    width: 90%;
    height: 25px;
    background: #ecf0f1;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
}
#progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(to right, #3498db, #2ecc71);
    transition: width 0.5s ease;
}
#progress-text {
    margin: 10px 0 25px;
    font-weight: bold;
    color: #2c3e50;
}
.choices-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
}
.song {
    display: inline-block;
    margin: 10px;
    padding: 18px 25px;
    border: 2px solid #ddd;
    border-radius: 12px;
    cursor: pointer;
    font-size: 18px;
    font-weight: 500;
    background: #fff;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    min-width: 220px;
    flex: 1;
    max-width: 300px;
}
.song:hover {
    background: #3498db;
    color: white;
    transform: translateY(-5px);
    box-shadow: 0 7px 14px rgba(0, 0, 0, 0.15);
    border-color: #3498db;
}
#result {
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    text-align: left;
}
#result h2 {
    color: #2c3e50;
    text-align: center;
    margin-bottom: 20px;
}
#result ol {
    padding-left: 20px;
    columns: 2;
    column-gap: 30px;
}
#result li {
    margin-bottom: 12px;
    break-inside: avoid;
    font-size: 16px;
    padding: 8px 0;
    border-bottom: 1px dashed #ddd;
}
#copy-btn {
    margin: 25px auto 10px;
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: #2ecc71;
    color: white;
    font-weight: bold;
    transition: all 0.3s;
    display: block;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
#copy-btn:hover {
    background: #27ae60;
    transform: translateY(-2px);
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}
.footer {
    margin-top: 30px;
    color: #7f8c8d;
    font-size: 14px;
}
.explanation {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin: 20px 0;
    text-align: left;
    font-size: 14px;
}
@media (max-width: 600px) {
    .song {
        min-width: 100%;
        font-size: 16px;
        padding: 15px;
    }
    #result ol {
        columns: 1;
    }
    .container {
        padding: 20px;
    }
}
</style>
</head>
<body>
<div class="container">
    <h1>トゲナシトゲアリ　最推し楽曲</h1>
    <p class="subtitle">好きな曲をクリックしてランキングを作成しましょう</p>
    
    <div id="progress">
        <div id="progress-bar"></div>
    </div>
    <p id="progress-text"></p>
    
    <div class="choices-container" id="choices"></div>
    
    <div id="result"></div>
</div>

<script>
// 曲リスト
const songNames = [
    "名もなき何もかも", "偽りの理", "気鬱、白濁す", "理想的パラドクスとは",
    "爆ぜて咲く", "黎明を穿つ", "極私的極彩色アンサー", "傷つき傷つけ痛くて辛い",
    "運命に賭けたい論理", "サヨナラサヨナラサヨナラ", "雑踏、僕らの街", "空の箱",
    "誰にもなれない私だから", "声なき魚", "視界の隅 朽ちる音", "心象的フラクタル",
    "空白とカタルシス", "運命の華", "闇に溶けてく", "蝶に結いた赤い糸",
    "ダレモ", "飛べない蝶は夢を見る", "薄采ディスプレイ", "蜃気楼ニ問フ",
    "碧いif", "無知のち私", "渇く、憂う", "吹き消した灯火", 
    "生きて生きてゆく", "臆病な白夜", "最期の禱り"
];

// Eloレーティングシステムのパラメータ
const INITIAL_RATING = 1000;
const K_FACTOR = 32; // レーティング変動の感度

let songs = songNames.map(name => ({ name, rating: INITIAL_RATING }));
let pairs = [];
let currentIndex = 0;
const totalRounds = 6; // ラウンド数
let round = 0;

// 配列をシャッフル
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// Eloレーティングの更新
function updateRatings(winner, loser) {
    // 期待勝率の計算
    const expectedScoreWinner = 1 / (1 + Math.pow(10, (loser.rating - winner.rating) / 400));
    const expectedScoreLoser = 1 / (1 + Math.pow(10, (winner.rating - loser.rating) / 400));
    
    // 新しいレーティングの計算
    winner.rating = Math.round(winner.rating + K_FACTOR * (1 - expectedScoreWinner));
    loser.rating = Math.round(loser.rating + K_FACTOR * (0 - expectedScoreLoser));
}

// 現在のラウンドの対戦ペアを生成
function generatePairs() {
    let list = songs.slice();
    shuffle(list);
    let res = [];
    for (let i = 0; i < list.length - 1; i += 2) {
        res.push([list[i], list[i + 1]]);
    }
    if (list.length % 2 === 1) {
        // 奇数の場合、最後の曲は自動的に勝ち進む（レーティングは変更しない）
        res.push([list[list.length - 1]]);
    }
    return res;
}

// 次の対戦を表示
function showNext() {
    if (currentIndex >= pairs.length) {
        round++;
        if (round >= totalRounds) {
            showResult();
            return;
        }
        pairs = generatePairs();
        currentIndex = 0;
        showNext();
        return;
    }
    
    let pair = pairs[currentIndex];
    const div = document.getElementById("choices");
    
    if (pair.length === 1) { // 奇数の場合、自動的に勝ち進む
        currentIndex++;
        showNext();
        return;
    }
    
    div.innerHTML = `
        <div class="song" onclick="choose(0)">${pair[0].name}</div>
        <div class="song" onclick="choose(1)">${pair[1].name}</div>
    `;
    updateProgress();
}

// ユーザーの選択を処理
function choose(index) {
    const winner = pairs[currentIndex][index];
    const loser = pairs[currentIndex][index === 0 ? 1 : 0];
    
    // Eloレーティングを更新
    updateRatings(winner, loser);
    
    currentIndex++;
    showNext();
}

// 進捗状況を更新
function updateProgress() {
    const totalComparisons = totalRounds * Math.floor(songs.length / 2);
    const done = round * Math.floor(songs.length / 2) + currentIndex;
    const percent = ((done / totalComparisons) * 100).toFixed(1);
    document.getElementById("progress-bar").style.width = percent + "%";
    document.getElementById("progress-text").textContent = `ラウンド: ${round + 1} / ${totalRounds} (${percent}% 完了)`;
}

// 最終結果を表示
function showResult() {
    let sorted = songs.slice().sort((a, b) => b.rating - a.rating);
    let html = "<h2>最終ランキング </h2><ol>";
    let textForCopy = "トゲナシトゲアリ 楽曲ランキング:\n\n";
    
    sorted.forEach((song, index) => {
        html += `<li><strong>${song.name}</strong>（評価: ${song.rating}）</li>`;
        textForCopy += `${index + 1}位: ${song.name}（評価: ${song.rating}）\n`;
    });
    
    html += "</ol><button id='copy-btn' onclick='copyResult()'>結果をコピー</button>";
    document.getElementById("choices").innerHTML = "";
    document.getElementById("result").innerHTML = html;
    window.resultText = textForCopy;
    document.getElementById("progress-bar").style.width = "100%";
    document.getElementById("progress-text").textContent = "完了！";
}

// 結果をクリップボードにコピー
function copyResult() {
    navigator.clipboard.writeText(window.resultText).then(
        () => alert("ランキングをコピーしました！"),
        () => alert("コピーに失敗しました。手動でコピーしてください。")
    );
}

// 初期化
pairs = generatePairs();
showNext();
</script>

<div class="footer">
</div>
</body>
</html>
